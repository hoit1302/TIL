# 8장 데이터베이스 설계

## 01. 데이터베이스 설계 단계

![image](https://user-images.githubusercontent.com/68107000/122656540-76997480-d196-11eb-9476-20377fffb80f.png)

## 02. 요구 사항 분석

결과물: 요구 사항 명세서

주요 작업 

- 데이터베이스를 실제로 사용할 주요 사용자의 범위를 결정
- 사용자가 조직에서 수행하는 업무를 분석
- 면담, 설문 조사, 업무 관련 문서 분석 등의 방법을 이용해 요구 사항 수집
- 수집된 요구 사항에 대한 분석 결과를 요구 사항 명세서로 작성

예시: 인터넷으로 회원들에게 상품을 판매하는 한빛 마트의 데이터베이스 개발

![image](https://user-images.githubusercontent.com/68107000/122656551-8618bd80-d196-11eb-8d31-d5b5e40bcda4.png)

## 03. 개념적 설계

**목적**

- **DBMS에 독립적**인 개념적 스키마 설계
- 요구 사항 분석 결과물을 개념적 데이터 모델을 이용해 개념적 구조로 표현
- 개념적 모델링 – 일반적으로 E-R 모델을 많이 이용

**결과물** 

- 개념적 스키마 : E-R 다이어그램 또는 IE 표기법

**주요 작업** 

- 요구 사항 분석 결과를 기반으로 중요한 개체를 추출하고 개체 간의 관계를 결정하여 E-R 다이어그램으로 표현

**작업과정**

- STEP 1) 개체 추출, 각 개체의 주요 속성과 키 속성 선별 
- STEP 2) 개체 간의 관계 결정 
- STEP 3) E-R 다이어그램 또는 IE 표기법으로 표현

### STEP 1) 개체 추출, 각 개체의 주요 속성과 키 속성 선별 

**개체** : 저장할 만한 가치가 있는 중요 데이터를 가진 사람이나 사물 등 

**개체 추출 방법** 

- 요구 사항 문장에서 업무와 관련이 깊은 의미 있는 **명사**를 찾아라! 
  - 업무와 관련이 적은 일반적이고 광범위한 의미의 명사는 제외 (소거법)
  - 의미가 같은 명사가 여러 개일 경우는 대표 명사 하나만 선택
- 찾아낸 명사를 **개체와 속성으로 분류**하라!

**예시**

![image](https://user-images.githubusercontent.com/68107000/122656564-9d57ab00-d196-11eb-8463-dda08d37be1e.png)

### STEP 2) 개체 간의 관계 결정 

**관계** : 개체 간의 의미 있는 연관성

**관계 추출 방법** 

- 요구 사항 문장에서 개체 간의 연관성을 **의미 있게 표현한 동사**를 찾아라! 
  - 의미가 같은 동사가 여러 개일 경우는 대표 동사 하나만 선택 
- 찾아낸 관계에 대해 **매핑 카디널리티**와 **참여 특성**, (종속성)을 결정하라! 
  - 매핑 카디널리티 : 일대일(1:1), 일대다(1:n), 다대다(n:m) 
  - 참여 특성 : 필수적 참여 / 선택적 참여

**예시**

```
⑧ 각 상품은 한 제조업체가 공급하고, 제조업체 하나는 여러 상품을 공급할 수 있다.
⑨ 제조업체가 상품을 공급하면 공급일자와 공급량 정보를 유지해야 한다.
```

- **관계: 공급**

  - “제조업체” 개체와 상품” 개체가 맺는 관계, 일대다(1:n) 관계

  - “상품” 개체는 관계에 필수적으로 참여 / “제조업체” 개체는 관계에 선택적으로 참여

    왜? 제조업체는 **공급**을 할수도 있고 안할 수 있는 선택적 개체이지만 제조업자가 공급했을 때 상품은 필수적으로 공급됨. 선택할 수 없음.

- “공급” 관계의 속성 : 공급일자, 공급량

**예시 결과**

![image](https://user-images.githubusercontent.com/68107000/122657714-178d2d00-d1a1-11eb-9204-3f77570bedc7.png)

### STEP 3-1) E-R 다이어그램으로 표현

![image](https://user-images.githubusercontent.com/68107000/122657734-3ab7dc80-d1a1-11eb-89a0-ac62557e60e9.png)

###  STEP 3-2) IE 표기법으로 표현

**사용하는 기호의 의미**

![image](https://user-images.githubusercontent.com/68107000/122657090-4a342700-d19b-11eb-9d3d-adfa74acc607.png)

#### 예시 1 - 부서와 직원

**ER 다이어그램**

![image](https://user-images.githubusercontent.com/68107000/122656856-53bc8f80-d199-11eb-9ea7-50f6162a77ce.png)

E-R 다이어그램을 통해 관계를 살펴보면, 

부서과 직원의 매핑 카디널리티는 1 : N 이고, 

소속이란 관계에서 부서가 포함하고 직원은 소속되는 관계로 **부서가 주인됨**(부서는 직원을 포함할 수도 있고 안할 수도 있음)을 알 수 있다. 따라서 부서는 선택 참여이지만 직원은 필수 참여이다.

직원은 부서에 포함되지 않아도 독립적으로 존재할 수 있으므로 직원이란 존재는 약한 객체 즉 종속적인 개체가 아니다. 따라서 이중 마름모가 아닌 단일 마름모로 표현하였다.

**IE 표기법**

![image](https://user-images.githubusercontent.com/68107000/122656846-48696400-d199-11eb-9008-a6186310cd5d.png)

위에서 해석한 결과대로 IE 표기법으로 바꾸면 위와 같다.

- 매핑 카디널리티에 의해 삼각발이 그려지고
- 종속적인 관계가 아니므로 직선이 아닌 점선으로 표기하였으며
- 직원은 필수참여, 부서는 필수 및 선택 참여를 표기하였다. (반대 방향으로 생각)

#### 예시 2 - 직원과 가족

**ER 다이어그램**

![image](https://user-images.githubusercontent.com/68107000/122657501-f9263200-d19e-11eb-8d27-117cd4e24a33.png)

**IE 표기법**

![image](https://user-images.githubusercontent.com/68107000/122656853-4f907200-d199-11eb-8b57-ddb71a08c33d.png)
위와 같은 논리로 그리면 된다.

- 매핑 카디널리티에 의해 삼각발이 그려지고
- 종속적인 관계 이므로 직선으로 관계를 잇고
- 가족은 필수참여, 부직원는 필수 및 선택 참여를 표기하였다. (반대 방향으로 생각)

## 04. 논리적 설계

**목적** 

- **DBMS에 적합한** 논리적 스키마 설계
  - 즉, 사용한 **DBMS의 특성**을 고려해야 함
- 개념적 스키마를 논리적 데이터 모델을 이용해 논리적 구조로 표현
- 논리적 모델링(데이터 모델링) - 일반적으로 관계 데이터 모델을 많이 이용

**결과물** 

- 논리적 스키마 : 릴레이션 스키마 

**주요 작업** 

- 개념적 설계 단계의 결과물인 E-R 다이어그램을 릴레이션 스키마로 변환
- 릴레이션 스키마로 변환 후 속성의 데이터 타입, 길이, 널 값 허용 여부, 기본 값, 제약조건 등을 세부적으로 결정하고 결과를 문서화시킴

**E-R 다이어그램을 릴레이션 스키마로 변환하는 규칙** 

(변환 규칙을 순서대로 적용하되, 해당되지 않는 규칙은 제외함)

- 규칙 1 : 모든 개체는 릴레이션으로 변환한다.
- 규칙 2 : 다대다(n:m) 관계는 릴레이션으로 변환한다. 
- 규칙 3 : 일대다(1:n) 관계는 외래키로 표현한다.
- 규칙 4 : 일대일(1:1) 관계는 외래키로 표현한다.
- 규칙 5 : 다중 값 속성은 릴레이션으로 변환한다. 



### 규칙 1 : 모든 개체는 릴레이션으로 변환한다

![image](https://user-images.githubusercontent.com/68107000/122657530-3b4f7380-d19f-11eb-94b4-b7d48164397a.png)

E-R 다이어그램의 각 개체를 하나의 릴레이션으로 변환

- 개체의 이름 → 릴레이션 이름
- 개체의 속성 → 릴레이션의 속성 
- 개체의 키 속성 → 릴레이션의 기본키 
- 개체의 속성이 **복합 속성인 경우**에는 복합 속성을 구성하고 있는 **단순 속성만** 릴레이션의 속성으로 변환
  - ex) 주소 - 우편주소, 기본주소, 상세주소의 경우 구체적인 3개를 속성으로 변환

### 규칙 2 : 다대다(n:m) 관계는 릴레이션으로 변환한다

![image](https://user-images.githubusercontent.com/68107000/122657539-5326f780-d19f-11eb-90f8-ea9a95c33061.png)

 E-R 다이어그램의 다대다 관계를 하나의 릴레이션으로 변환 

- 관계의 이름 → 릴레이션 이름 
- 관계의 속성 → 릴레이션의 속성
- 관계에 참여하는 개체를 규칙 1에 따라 릴레이션으로 변환한 후 이 릴레이션의 기본키를 관계 릴레이션에 포함시켜 외래키로 지정하고, 외래키들을 조합하여 관계 릴레이션의 기본키로 지정 (하지만 관계 개체의 기본키를 따로 만드는 것이 더욱 일반적이다)

### 규칙 3 : 일대다(1:n) 관계는 외래키로 표현한다

E-R 다이어그램의 일대다 관계는 외래키로만 표현 

- **규칙 3-1: 일반적인 일대다 관계는 외래키로 표현한다.**

  ![image](https://user-images.githubusercontent.com/68107000/122657552-6fc32f80-d19f-11eb-8af0-4e28a38a35de.png)

  - 일대다(1:n) 관계에서 1측 개체 릴레이션의 기본키를 **n측 개체 릴레이션에** 포함시켜 **외래키로 지정**
  - 관계의 속성들도 n측 개체 릴레이션에 포함시킴

- **규칙 3-2: 약한 개체가 참여하는 일대다 관계는 외래키를 포함해서 기본키로 지정한다.**

  ![image](https://user-images.githubusercontent.com/68107000/122657827-d77a7a00-d1a1-11eb-92d2-c7809dfd27ca.png)

  - 일대다(1:n) 관계에서 1측 개체 릴레이션의 기본키를 n측 개체 릴레이션에 포함시켜 외래키로 지정
  - 관계의 속성들도 n측 개체 릴레이션에 포함시킴
  - n측 개체 릴레이션은 **외래키를 포함하여 기본키를 지정**함 - 꼭꼭꼭!
    - **약한 개체는 강한 개체에 따라 존재 여부가 결정되므로** 강한 개체의 기본키를 이용해 식별해야 함

### 규칙 4 : 일대일(1:1) 관계는 외래키로 표현한다

 E-R 다이어그램의 일대일 관계는 외래키로만 표현 

- **규칙 4-1: 일반적인 일대일 관계는 외래키를 서로 주고받는다.**

  ![image](https://user-images.githubusercontent.com/68107000/122657557-8cf7fe00-d19f-11eb-9b52-e559b78e311a.png)

  - 관계에 참여하는 개체 릴레이션들이 서로의 기본키를 주고받아 외래키로 지정
  - 관계의 속성들도 모든 개체 릴레이션에 포함시킴 
  - 불필요한 **데이터 중복**이 발생할 수 있음

- **규칙 4-2: 일대일 관계에 필수적으로 참여하는 개체의 릴레이션만 외래키를 받는다.**

  ![image](https://user-images.githubusercontent.com/68107000/122657563-9a14ed00-d19f-11eb-8907-00343ffb712e.png)

  - 관계에 필수적으로 참여하는 개체 릴레이션에만 외래키를 포함시킴
  - 관계의 속성들은 관계에 필수적으로 참여하는 개체 릴레이션에 포함시킴

- **규칙 4-3: 모든 개체가 일대일 관계에 필수적으로 참여하면 릴레이션 하나로 합친다.**

  ![image](https://user-images.githubusercontent.com/68107000/122657571-b6b12500-d19f-11eb-900f-041ec2064ce5.png)
  
  - 관계에 참여하는 개체 릴레이션들을 하나의 릴레이션으로 합쳐서 표현
  - 관계의 이름을 릴레이션 이름으로 사용하고, 관계에 참여하는 두 개체의 속성들을 관계 릴레이션에 모두 포함시킴
  - 두 개체 릴레이션의 키 속성을 조합하여 관계 릴레이션의 기본키로 지정 (but 새로운 키를 기본키로 지정하는 것이 더 일반적임.)

### 규칙 5 : 다중 값 속성은 릴레이션으로 변환한다

![image](https://user-images.githubusercontent.com/68107000/122657577-c597d780-d19f-11eb-9fd4-2555fb5c69d6.png)

 E-R 다이어그램의 다중 값 속성은 독립적인 릴레이션으로 변환

- 다중 값 속성과 함께 그 속성을 가지고 있던 개체 릴레이션의 기본키를 외래키로 가져와 새로운 릴레이션에 포함시킴
- 새로운 릴레이션의 기본키는 다중 값 속성과 외래키를 조합하여 지정

### 기타 고려 사항

**모든 관계를 독립적인 릴레이션으로 변환할 수 있다.**

- 속성이 많은 관계는 유형에 상관없이 릴레이션으로의 변환을 고려할 수 있음

**개체가 자기 자신과 관계를 맺는 순환 관계도 기본 규칙을 그대로 적용한다.**

![image](https://user-images.githubusercontent.com/68107000/122657585-dcd6c500-d19f-11eb-868b-85e59a197729.png)

**예시 결과**

![image](https://user-images.githubusercontent.com/68107000/122657615-21faf700-d1a0-11eb-9885-ef1a133ce5ef.png)

### 테이블 명세서 작성

- 테이블 명세서 : 릴레이션 스키마에 대한 설계 정보를 기술한 문서
- 릴레이션 스키마 변환 후 속성의 데이터 타입과 길이, 널 값 허용 여부, 기본값, 제약조건 등을 세부적으로 결정하고 문서화시킴

![image](https://user-images.githubusercontent.com/68107000/122657623-3dfe9880-d1a0-11eb-96b7-501254c37cc2.png)

## 05. 물리적 설계와 구현

### **설계 4 단계** : 물리적 설계

DBMS로 구현 가능한 물리적 구조를 설계하는 단계이다.

하드웨어나 운영체제의 특성을 고려하여 필요한 인덱스 구조나 내부 저장 구조 등에 대한 물리적인 구조를 설계한다.

### 설계 5 단계 : 구현

SQL로 작성한 명령문을 DBMS에서 실행하여 데이터베이스를 실제로 생성

