# 7장 뷰

## 04 뷰

### 04-1 뷰란?

- **다른 테이블을 기반으로 만들어진 가상 테이블** 
- 뷰는 기본 테이블을 들여다 볼 수 있는 창의 역할을 담당
- 데이터를 실제로 저장하지 않고 논리적으로만 존재하는 테이블이지만, 일반 테이블과 동일한 방법으로 사용
  - 다른 뷰를 기반으로 새로운 뷰를 만드는 것도 가능함
- 뷰를 통해 기본 테이블의 내용을 쉽게 검색할 수는 있지만, **기본 테이블의 내용을 변화시키는 작업은 제한적**으로 이루어짐 
  - 기본 테이블: 뷰를 만드는데 기반이 되는 물리적인 테이블

### 04-2 뷰 검색: CREATE  VIEW 문

```mssql
CREATE VIEW 뷰이름[(속성리스트)]
AS SELECT 문
[ WITH CEHCK OPTION ]
```

- CREATE VIEW 키워드와 함께 생성할 뷰의 이름과 뷰를 구성하는 속성의 이름을 나열

  - 속성 리스트를 생략하면 SELECT 절에 나열된 속성의 이름을 그대로 사용

- AS 키워드와 함께 기본 테이블에 대한 SELECT 문 작성 

  - SELECT 문은 생성하려는 뷰의 정의를 표현하며 ORDER BY는 사용 불가

- WITH CHECK OPTION

  - 뷰에 삽입이나 수정 연산을 할 때 SELECT 문에서 제시한 뷰의 정의 조건을 위반하면 수행되지 않도록 하는 제약조건을 지정

  ```mssql
  Q. 고객 테이블에서 등급이 vip인 고객의 고객아이디, 고객이름, 나이로 구성된 뷰를 우수고객이라는 이름으로 생성해보자. 그런 다음 우수고객 뷰의 모든 내용을 검색해보자.
  CREATE VIEW 우수고객(고객아이디, 고객이름, 나이)
  AS SELECT 고객아이디, 고객이름, 나이
  	FROM 고객
	WHERE 등급 = 'vip'
  WITH CHECK OPTION; -- 역할: 등급이 없음. 삽입 시 등급이 null로 들어가서 안되게 막음.
  
  select * from 우수고객;
  
  -- 만약 이렇게 생성이 되었을 시, 
  CREATE VIEW 우수고객(고객아이디, 고객이름, 나이, 등급)
  AS SELECT 고객아이디, 고객이름, 나이, 등급
  	FROM 고객
  	WHERE 등급 = 'vip'
  WITH CHECK OPTION; -- 역할: 등급이 vip가 아니면 삽입이 안되도록 막음.
  
  Q. 제품 테이블에서 제조업체별 제품수로 구성된 뷰를 업체별제품수라는 이름으로 생성해보자
  CREATE VIEW 업체별제품수(제조업체, 제품수)
  AS SELECT 제조업체, COUNT(*)
  	FROM 제품
  	GROUP BY 제조업체
  WITH CHECK OPTION;
  ```
  

### 04-3 뷰 활용: SELECT 문

- 뷰는 일반 테이블과 **같은 방법**으로 원하는 데이터를 검색할 수 있음
  - 뷰에 대한 SELECT 문이 내부적으로는 기본 테이블에 대한 SELECT 문으로 변환되어 수행 
- 검색 연산은 모든 뷰에 수행 가능

### 04-4 뷰 활용 : INSERT, UPDATE, DELETE 문

- 뷰에 대한 삽입, 수정, 삭제 연산은 실제로 기본 테이블에 수행되므로 **결과적으로는 기본 테이블이 변경됨**

- 뷰에 대한 삽입, 수정, 삭제 연산은 제한적으로 수행됨

  - 변경 가능한 뷰 vs 변경 불가능한 뷰

- 변경 불가능한 뷰의 특징

  - **기본 테이블의 기본키를 구성하는 속성이 포함되어 있지 않**은 뷰
  - 기본 테이블에 있던 내용이 아닌 **집계 함수로 새로 계산된 내용을 포함**하는 뷰
  - **DISTINCT** 키워드를 포함하여 정의한 뷰 
  - **GROUP BY** 절을 포함하여 정의한 뷰 
  - 여러 개의 테이블을 조인하여 정의한 뷰는 변경이 불가능한 경우가 많음

  ![image](https://user-images.githubusercontent.com/68107000/114983080-26b6dc80-9ecb-11eb-9f01-6b28c395add0.png)

  -> 제품 1뷰는 변경 가능한 뷰인가? O

  ![image](https://user-images.githubusercontent.com/68107000/114983113-2d455400-9ecb-11eb-91ac-ab97d4e6c5ca.png)

  -> 제품 2뷰는 변경 가능한 뷰인가? X 기본키가 포함되어 있지 않음.

### 04-5 뷰의 장점

- **질의문을 좀 더 쉽게 작성**할 수 있다.
  - GROUP BY, 집계 함수, 조인 등을 이용해 뷰를 미리 만들어 놓으면, 복잡한 SQL 문을 작성하지 않아도 SELECT 절과 FROM 절만으로도 원하는 데이터의 검색이 가능 
- 데이터의 **보안 유지**에 도움이 된다.
  - 자신에게 제공된 뷰를 통해서만 데이터에 접근하도록 권한 설정이 가능 
- 데이터를 좀 더 **편리하게 관리**할 수 있다.
  - 제공된 뷰와 관련이 없는 다른 내용에 대해 사용자가 신경 쓸 필요가 없음

### 04-6 뷰 삭제 : DROP VIEW 문

```mssql
DROP VIEW 뷰이름;
```

- 뷰를 삭제해도 **기본 테이블은 영향을 받지 않음**
- 만약, 삭제할 뷰를 참조하는 제약조건이 존재한다면?
  - 예) 삭제할 뷰를 이용해 만들어진 다른 뷰가 존재하는 경우
  - 뷰 삭제가 수행되지 않음
  - 관련된 제약조건을 먼저 삭제해야 함

