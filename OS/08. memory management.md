# 08 memory management

## 01 **Logical vs Physical Address**

**Logical Address (Virtual Address)**

- í”„ë¡œì„¸ìŠ¤ë§ˆë‹¤ ë…ë¦½ì ìœ¼ë¡œ ê°€ì§€ëŠ” ì£¼ì†Œ ê³µê°„
- ê° í”„ë¡œì„¸ìŠ¤ë§ˆë‹¤ 0ë²ˆì§€ë¶€í„° ì‹œì‘
- ***<u>CPUê°€ ë³´ëŠ” ì£¼ì†ŒëŠ” Logical Address</u>***

**Physical Address**

- ë©”ëª¨ë¦¬ì— ì‹¤ì œ ì˜¬ë¼ê°€ëŠ” ìœ„ì¹˜

## 02 **ì£¼ì†Œ ë°”ì¸ë”© (Address Binding)**

ì£¼ì†Œ ë°”ì¸ë”©: ì£¼ì†Œë¥¼ ê²°ì •í•˜ëŠ” ê²ƒ

- Symbolic Address â†’ Logical Address â†’ Physical Address

![image](https://user-images.githubusercontent.com/68107000/121514351-df5e4f80-ca26-11eb-9643-3c2c37d0fe6c.png)

ì»´íŒŒì¼ ì‹œ: (ì—„ë°€í•˜ê²Œ ë§í•˜ë©´ assemblerì— ì˜í•´) ë…¼ë¦¬ì  ì£¼ì†Œë¥¼ ê°–ëŠ” ì‹¤í–‰ íŒŒì¼ì´ ìƒì„±

ì‹¤í–‰ì‹œì‘ ì‹œ: loaderì— ì˜í•´ physical addressê°€ í• ë‹¹ë¨



**Compile time binding**

- ë¬¼ë¦¬ì  ë©”ëª¨ë¦¬ ì£¼ì†Œê°€ ì»´íŒŒì¼ ì‹œ ì´ë¯¸ ì•Œë ¤ì§
- ì‹œì‘ ìœ„ì¹˜ ë³€ê²½ì‹œ ì¬ì»´íŒŒì¼
- ì»´íŒŒì¼ëŸ¬ëŠ” **ì ˆëŒ€ ì½”ë“œ(absolute code)** ìƒì„± - ì ˆëŒ€ ì•ˆ ì›€ì§ì´ë‹ˆê¹Œ

**Load time binding**

- loaderì˜ ì±…ì„í•˜ì— ë¬¼ë¦¬ì  ë©”ëª¨ë¦¬ ì£¼ì†Œ ë¶€ì—¬
- ì»´íŒŒì¼ëŸ¬ê°€ **ì¬ë°°ì¹˜ê°€ëŠ¥ ì½”ë“œ (relocatable code)**ë¥¼ ìƒì„±í•œ ê²½ìš° ê°€ëŠ¥ - ìƒëŒ€ ì£¼ì†ŒëŠ” ê³ ì •ë˜ê³ , ì ˆëŒ€ ì£¼ì†ŒëŠ” ë³€ê²½ ê°€ëŠ¥

**Execution time binding (Run Time Binding)**

- **ìˆ˜í–‰ì´ ì‹œì‘ëœ ì´í›„**ì—ë„ í”„ë¡œì„¸ìŠ¤ì˜ **ë©”ëª¨ë¦¬ ìƒ ìœ„ì¹˜ë¥¼ ì˜®ê¸¸ ìˆ˜ ìˆìŒ**

- CPUê°€ ì£¼ì†Œë¥¼ ì°¸ì¡°í•  ë•Œë§ˆë‹¤ Bindingì„ ì ê²€ (Address Mapping Table - 300ì˜€ëŠ”ë° ì§€ê¸ˆ ì•ˆë°”ê¼ˆë‹ˆ ì™€ ê°™ì´ ë¬¼ì–´ë´„) 

- í•˜ë“œì›¨ì–´ì ì¸ ì§€ì›ì´ í•„ìš”

  (base limit registers, MMU)

## 03 Memory Management Unit (MMU)

**Dynamic Relocation** ì‹œ, **Hardware Support** for Address Translation

![image](https://user-images.githubusercontent.com/68107000/121517526-71b42280-ca2a-11eb-99be-e2afd6487ac9.png)

MMU (Memory Management Unit)

- Logical addressë¥¼ **Physical Addressë¡œ ë§¤í•‘**í•´ ì£¼ëŠ” Hardware device

MMU Scheme

- ì‚¬ìš©ì í”„ë¡œì„¸ìŠ¤ê°€ CPUì—ì„œ ìˆ˜í–‰ë˜ë©° ìƒì„±í•´ì£¼ëŠ” ëª¨ë“  ì£¼ì†Œê°’ì— ëŒ€í•´ (cpuëŠ” 0ë²ˆì§€ì—ì„œë¶€í„° ì‹œì‘í•˜ëŠ” logical addressë§Œ ì•ˆë‹¤) **Base Register (= Relocation Register)ì˜ ê°’ì„ ë”í•œë‹¤.**

User Program

- Logical Addressë§Œì„ ë‹¤ë£¬ë‹¤.
- ì‹¤ì œ Physical Addressë¥¼ ë³¼ ìˆ˜ ì—†ìœ¼ë©° ì•Œ í•„ìš”ê°€ ì—†ë‹¤.

ìš´ì˜ì²´ì œ ë° ì‚¬ìš©ì í”„ë¡œì„¸ìŠ¤ ê°„ì˜ ë©”ëª¨ë¦¬ ë³´í˜¸ë¥¼ ìœ„í•´ ì‚¬ìš©í•˜ëŠ” **ë ˆì§€ìŠ¤í„°**

- **Relocation Register (Base Register)**: ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ë¬¼ë¦¬ì  ë©”ëª¨ë¦¬ ì£¼ì†Œì˜ ìµœì†Œê°’

- **Limit Register**: ë…¼ë¦¬ì  ì£¼ì†Œì˜ ë²”ìœ„

  - logical address < limit registerë¥¼ ë§Œì¡±í•˜ì§€ ëª»í•˜ë©´ trap (software interrupt - exception ë°œìƒ)

    kernalì´ ë³´í†µ processë¥¼ killí•˜ê³  ì‚¬ìš©ìì—ê²Œ segmentation faultê°€ ë‚˜ì„œ í”„ë¡œê·¸ë¨ì´ ëë‚¬ìŒì„ ì•Œë¦°ë‹¤.

### 04 **ìš©ì–´ ì •ë¦¬**

#### 04-1 **Dynamic Loading**

- í”„ë¡œì œìŠ¤ ì „ì²´ë¥¼ ë©”ëª¨ë¦¬ì— ë¯¸ë¦¬ ë‹¤ ì˜¬ë¦¬ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ í•´ë‹¹ ë£¨í‹´ì´ ë¶ˆë ¤ì§ˆ ë•Œ ë©”ëª¨ë¦¬ì— loadí•˜ëŠ” ê²ƒ
- **Memory Utilizationì˜ í–¥ìƒ**
- ê°€ë”ì”© ì‚¬ìš©ë˜ëŠ” ë§ì€ ì–‘ì˜ ì½”ë“œì˜ ê²½ìš° ìœ ìš©
  - ex) ì˜¤ë¥˜ ì²˜ë¦¬ ë£¨í‹´
- ìš´ì˜ì²´ì œì˜ íŠ¹ë³„í•œ ì§€ì› ì—†ì´ í”„ë¡œê·¸ë¨ ìì²´ì—ì„œ êµ¬í˜„ ê°€ëŠ¥
  - OSëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ ì§€ì› ê°€ëŠ¥. ì¦‰ OS ìì²´ì˜ ê¸°ëŠ¥ì€ ì•„ë‹˜

\* Loading: ë©”ëª¨ë¦¬ì— ë°ì´í„°ë¥¼ ì˜¬ë¦¬ëŠ” ê²ƒ

ì—¬ê¸°ì„œ ë§í•˜ëŠ” Dynamic Loadingì€ ìš´ì˜ì²´ì œê°€ í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ í”„ë¡œê·¸ë˜ë¨¸ê°€ ì§„í–‰í•˜ëŠ” ê²ƒì„ ë§í•¨.

#### 04-2 **Dynamic Linking**

- Linkingì„ ì‹¤í–‰ ì‹œê°„ (Execution Time)ê¹Œì§€ ë¯¸ë£¨ëŠ” ê¸°ë²•
- **Static Linking**
  - ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í”„ë¡œê·¸ë¨ì˜ ì‹¤í–‰ íŒŒì¼ ì½”ë“œì— í¬í•¨ë¨
  - ì‹¤í–‰ íŒŒì¼ì˜ í¬ê¸°ê°€ ì»¤ì§
  - ë™ì¼í•œ ë¼ì´ë¸ŒëŸ¬ë¥´ë¥¼ ê°ê°ì˜ í”„ë¡œì„¸ìŠ¤ê°€ ë©”ëª¨ë¦¬ì— ì˜¬ë¦¬ë¯€ë¡œ ë©”ëª¨ë¦¬ ë‚­ë¹„
  - ì˜ˆ) printf í•¨ìˆ˜ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì½”ë“œ
- **Dynamic Linking**
  - ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì‹¤í–‰ì‹œ ì—°ê²°ë¨
  - ë¼ì´ë¸ŒëŸ¬ë¦¬ í˜¸ì¶œ ë¶€ë¶„ì— ë¼ì´ë¸ŒëŸ¬ë¦¬ ë£¨í‹´ì˜ ìœ„ì¹˜ë¥¼ ì°¾ê¸° ìœ„í•œ stubì´ë¼ëŠ” ì‘ì€ ì½”ë“œë¥¼ ë‘ 
  - ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì´ë¯¸ ë©”ëª¨ë¦¬ì— ìˆìœ¼ë©´ ê·¸ ë£¨í‹´ì˜ ì£¼ì†Œë¡œ ê°€ê³  ì—†ìœ¼ë©´ **ë””ìŠ¤í¬ì—ì„œ ì½ì–´ì˜´**
  - ìš´ì˜ì²´ì œì˜ ë„ì›€ì´ í•„ìš”

#### 04-3 **Overlays**

- ë©”ëª¨ë¦¬ì— í”„ë¡œì„¸ìŠ¤ì˜ ë¶€ë¶„ ì¤‘ ì‹¤ì œ í•„ìš”í•œ ì •ë³´ë§Œì„ ì˜¬ë¦¼
- **í”„ë¡œì„¸ìŠ¤ì˜ í¬ê¸°ê°€ ë©”ëª¨ë¦¬ë³´ë‹¤ í´ ë•Œ** ìœ ìš©
- ìš´ì˜ì²´ì œì˜ ì§€ì›ì—†ì´ ì‚¬ìš©ìì— ì˜í•´ êµ¬í˜„
- ì‘ì€ ê³µê°„ì˜ ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•˜ë˜ ì´ˆì°½ê¸° ì‹œìŠ¤í…œì—ì„œ ìˆ˜ì‘ì—…ìœ¼ë¡œ í”„ë¡œê·¸ë˜ë¨¸ê°€ êµ¬í˜„
  - Manual Overlay ë¼ê³ ë„ ë¶€ë¦„
  - í”„ë¡œê·¸ë˜ë°ì´ ë§¤ìš° ë³µì¡

#### 04-4 **Swapping**

![image](https://user-images.githubusercontent.com/68107000/121520269-b1c8d480-ca2d-11eb-959f-215685ed6f7e.png)

- **Swapping**
  - í”„ë¡œì„¸ìŠ¤ë¥¼ ì¼ì‹œì ìœ¼ë¡œ ë©”ëª¨ë¦¬ì—ì„œ Backing Storeë¡œ ì«“ì•„ë‚´ëŠ” ê²ƒ
  - **pagingê³¼ ë‹¤ë¥´ê²Œ í”„ë¡œì„¸ìŠ¤ê°€ í†µì§¸ë¡œ ì›€ì§ì„.**

- **Backing Store (Swap area)**
  - ë””ìŠ¤í¬(disk): ë§ì€ ì‚¬ìš©ìì˜ í”„ë¡œì„¸ìŠ¤ ì´ë¯¸ì§€ë¥¼ ë‹´ì„ ë§Œí¼ ì¶©ë¶„íˆ ë¹ ë¥´ê³  í° ì €ì¥ ê³µê°„

- **Swap in / Swap out**
  - ì¼ë°˜ì ìœ¼ë¡œ ì¤‘ê¸° ìŠ¤ì¼€ì¥´ëŸ¬(swapper)ì— ì˜í•´ swap out ì‹œí‚¬ í”„ë¡œì„¸ìŠ¤ ì„ ì •
  - priority-based CPU scheduling algorithm
    - ìš°ì„ ìˆœìœ„ê°€ ë‚®ì€ í”„ë¡œì„¸ìŠ¤ë¥¼ swapped out ì‹œí‚´
    - ìš°ì„ ìˆœìœ„ê°€ ë†’ì€ í”„ë¡œì„¸ìŠ¤ë¥¼ ë©”ëª¨ë¦¬ì— ì˜¬ë ¤ ë†“ìŒ
  - **Compile Time í˜¹ì€ Load time binding**ì—ì„œëŠ” ì›ë˜ ë©”ëª¨ë¦¬ ìœ„ì¹˜ë¡œ swap in í•´ì•¼ í•¨
  - **Execution time binding**ì—ì„œëŠ” ì¶”í›„ ë¹ˆ ë©”ëª¨ë¦¬ ì˜ì—­ ì•„ë¬´ ê³³ì—ë‚˜ ì˜¬ë¦´ ìˆ˜ ìˆìŒ
  - Swap Timeì€ ëŒ€ë¶€ë¶„ Transfer time (swap ë˜ëŠ” ì–‘ì— ë¹„ë¡€í•˜ëŠ” ì‹œê°„)ì„

## 05 **Allocation of Physical Memory**

![image](https://user-images.githubusercontent.com/68107000/121617417-d6f62b00-ca9f-11eb-93f2-a56be4dfcd75.png)

- ë©”ëª¨ë¦¬ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë‘ ì˜ì—­ìœ¼ë¡œ ë‚˜ë‰˜ì–´ ì‚¬ìš©
  - **OS ìƒì£¼ ì˜ì—­**: Interrupt Vectorì™€ í•¨ê»˜ ë‚®ì€ ì£¼ì†Œ ì˜ì—­ ì‚¬ìš©
  - **ì‚¬ìš©ì í”„ë¡œì„¸ìŠ¤ ì˜ì—­**: ë†’ì€ ì£¼ì†Œ ì˜ì—­ ì‚¬ìš©

- ì‚¬ìš©ì í”„ë¡œì„¸ìŠ¤ ì˜ì—­ì˜ í• ë‹¹ ë°©ë²•
  - <u>**Contiguous allocation**</u>
    - ê°ê°ì˜ í”„ë¡œì„¸ìŠ¤ê°€ ë©”ëª¨ë¦¬ì˜ ì—°ì†ì ì¸ ê³µê°„ì— ì ì¬ë˜ë„ë¡ í•˜ëŠ” ê²ƒ
    - Fixed Partition Allocation - ê³ ì • ë¶„í•  ë°©ì‹
    - Variable Partition Allocation - ê°€ë³€ ë¶„í•  ë°©ì‹
  - <u>**Noncontiguous allocation**</u>
    - í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ê°€ ë©”ëª¨ë¦¬ì˜ ì—¬ëŸ¬ ì˜ì—­ì— ë¶„ì‚°ë˜ì–´ ì˜¬ë¼ê°ˆ ìˆ˜ ìˆìŒ
    - Paging
    - Segmentation
    - Paged Segmentation

## 06 **Contiguous Allocation**

### 06-1. ê³ ì • ë¶„í• (Fixed Partition) ë°©ì‹ê³¼ ê°€ë³€ ë¶„í• (Variable Partition) ë°©ì‹

![image](https://user-images.githubusercontent.com/68107000/121617388-c6de4b80-ca9f-11eb-8cec-6d4a3a34e2e7.png)

- **<u>ê³ ì • ë¶„í• (Fixed Partition) ë°©ì‹</u>**
  - ë¬¼ë¦¬ì  ë©”ëª¨ë¦¬ë¥¼ ëª‡ ê°œì˜ ì˜êµ¬ì  ë¶„í• (partition)ë¡œ ë‚˜ëˆ”
  - ë¶„í• ì˜ í¬ê¸°ê°€ ëª¨ë‘ ë™ì¼í•œ ë°©ì‹ê³¼ ì„œë¡œ ë‹¤ë¥¸ ë°©ì‹ì´ ì¡´ì¬
  - **ë¶„í• ë‹¹ í•˜ë‚˜ì˜ í”„ë¡œê·¸ë¨ ì ì¬**
  - ìœµí†µì„±ì´ ì—†ìŒ
    - **ë™ì‹œì— ë©”ëª¨ë¦¬ì— loadë˜ëŠ” í”„ë¡œê·¸ë¨ì˜ ìˆ˜**ê°€ ê³ ì •ë¨ (4ê°œì˜ ë¶„í•  â†’ ë™ì‹œì— ìµœëŒ€ 4ê°œ í”„ë¡œê·¸ë¨ ë¡œë“œ)
    - ìµœëŒ€ ìˆ˜í–‰ ê°€ëŠ¥ **í”„ë¡œê·¸ë¨ í¬ê¸° ì œí•œ**
  - Internal Fragmentation ë°œìƒ (External Fragmentationë„ ë°œìƒ)

- <u>**ê°€ë³€ ë¶„í• (Variable Partition) ë°©ì‹**</u>
  - í”„ë¡œê·¸ë¨ì˜ í¬ê¸°ë¥¼ ê³ ë ¤í•´ì„œ í• ë‹¹
  - ë¶„í• ì˜ í¬ê¸°, ê°œìˆ˜ê°€ ë™ì ìœ¼ë¡œ í• ë‹¹
  - ê¸°ìˆ ì  ê´€ë¦¬ ê¸°ë²• í•„ìš”
  - External Fragmentation ë°œìƒ

### 06-2. Fragmentationê³¼ Hole

- **fragmentation**
  - *External fragmentation (ì™¸ë¶€ ì¡°ê°)*
    - í”„ë¡œê·¸ë¨ì˜ í¬ê¸°ë³´ë‹¤ ë¶„í• ì˜ í¬ê¸°ê°€ ì‘ì€ ê²½ìš°
    - ì•„ë¬´ í”„ë¡œê·¸ë¨ì—ë„ ë°°ì •ë˜ì§€ ì•Šì€ ë¹ˆ ê³³ì¸ë°ë„ í”„ë¡œê·¸ë¨ì´ ì˜¬ë¼ê°ˆ ìˆ˜ ì—†ëŠ” ì‘ì€ ë¶„í• 
  - *Internal fragmentation (ë‚´ë¶€ ì¡°ê°)*
    - í”„ë¡œê·¸ë¨ í¬ê¸°ë³´ë‹¤ ë¶„í• ì˜ í¬ê¸°ê°€ í° ê²½ìš°
    - í•˜ë‚˜ì˜ ë¶„í•  ë‚´ë¶€ì—ì„œ ë°œìƒí•˜ëŠ” ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ë©”ëª¨ë¦¬ ì¡°ê°
    - íŠ¹ì • í”„ë¡œê·¸ë¨ì— ë°°ì •ë˜ì—ˆì§€ë§Œ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ê³µê°„

- **Hole**
  - ê°€ìš© ë©”ëª¨ë¦¬ ê³µê°„
  - ë‹¤ì–‘í•œ í¬ê¸°ì˜ holeë“¤ì´ ë©”ëª¨ë¦¬ ì—¬ëŸ¬ ê³³ì— í©ì–´ì ¸ ìˆìŒ
  - í”„ë¡œì„¸ìŠ¤ê°€ ë„ì°©í•˜ë©´ ìˆ˜ìš©ê°€ëŠ¥í•œ holeì„ í• ë‹¹
  - í”„ë¡œì„¸ìŠ¤ê°€ ë„ì°©í•˜ë©´ ìˆ˜ìš©ê°€ëŠ¥í•œ holeì„ í• ë‹¹
  - ìš´ì˜ì²´ì œëŠ” ë‹¤ìŒì˜ ì •ë³´ë¥¼ ìœ ì§€
    - í• ë‹¹ ê³µê°„
    - ê°€ìš© ê³µê°„ (Hole)

ë‘˜ì€ ë¹„ìŠ·í•œë° ë‰˜ì•™ìŠ¤ê°€ ë‹¤ë¦„

fragmentationì€ ì“°ì§€ ëª»í•˜ëŠ” ê³µê°„(ë©”ëª¨ë¦¬ ë‚­ë¹„), holeëŠ” ì“¸ ìˆ˜ ìˆëŠ” ê³µê°„

### 06-3. **Dynamic Storage Allocation Problem**

`ê°€ë³€ ë¶„í•  ë°©ì‹`ì—ì„œ Size nì¸ ìš”ì²­ì„ ë§Œì¡±í•˜ëŠ” **ê°€ì¥ ì ì ˆí•œ holeì„ ì°¾ëŠ”** ë¬¸ì œ

- **<u>First-fit</u>**
  - Sizeê°€ nì´ìƒì¸ ê²ƒ ì¤‘ **ìµœì´ˆë¡œ ì°¾ì•„ì§€ëŠ”** holeì— í• ë‹¹

- <u>**Best-fit**</u>
  - Sizeê°€ n ì´ìƒì¸ **ê°€ì¥ ì‘ì€ hole**ì„ ì°¾ì•„ì„œ í• ë‹¹
  - Holeë“¤ì˜ ë¦¬ìŠ¤íŠ¸ê°€ í¬ê¸°ìˆœìœ¼ë¡œ ì •ë ¬ë˜ì§€ ì•Šì€ ê²½ìš° **ëª¨ë“  holeì˜ ë¦¬ìŠ¤íŠ¸ë¥¼ íƒìƒ‰**í•´ì•¼í•¨
  - ë§ì€ ìˆ˜ì˜ ì•„ì£¼ ì‘ì€ holeë“¤ì´ ìƒì„±ë¨

- **<u>Worst-fit</u>**
  - **ê°€ì¥ í° hole**ì— í• ë‹¹
  - ì—­ì‹œ **ëª¨ë“  ë¦¬ìŠ¤íŠ¸ë¥¼ íƒìƒ‰**í•´ì•¼ í•¨
  - ìƒëŒ€ì ìœ¼ë¡œ ì•„ì£¼ í° holeë“¤ì´ ìƒì„±ë¨

ì‹¤í—˜ì ìœ¼ë¡œ first-fitì´ë‚˜ best-fitì´ worst-fitë³´ë‹¤ ì†ë„ì™€ ê³µê°„ ì´ìš©ì„ ì¸¡ë©´ì—ì„œ íš¨ê³¼ì ì¸ ê²ƒìœ¼ë¡œ ì•Œë ¤ì§

### 06-4. Compaction (ë­‰ì¹¨)

- External Fragmentation ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” í•œê°€ì§€ ë°©ë²•
- **ì‚¬ìš© ì¤‘ì¸ ë©”ëª¨ë¦¬ ì˜ì—­ì„ í•œêµ°ë°ë¡œ** ëª°ê³  **holeë“¤ì„ ë‹¤ë¥¸ í•œ ê³³ìœ¼ë¡œ ëª°ì•„** í° blockì„ ë§Œë“œëŠ” ê²ƒ
- Compactionì€ í”„ë¡œì„¸ìŠ¤ì˜ ì£¼ì†Œê°€ ì‹¤í–‰ ì‹œê°„ì— ë™ì ìœ¼ë¡œ ì¬ë°°ì¹˜ ê°€ëŠ¥í•œ ê²½ìš°ì—ë§Œ ì‹¤ì‹œí•  ìˆ˜ ìˆë‹¤.
  - ì¦‰, Execution time binding (=run time binding)ì—ì„œ ì ìš© ê°€ëŠ¥
- ë§¤ìš° ë¹„ìš©ì´ ë§ì´ ë“œëŠ” ë°©ë²•ì„
- ìµœì†Œí•œì˜ ë©”ëª¨ë¦¬ ì´ë™ìœ¼ë¡œ compactioní•˜ëŠ” ë°©ë²•ì€ ë§¤ìš° ë³µì¡í•œ ë¬¸ì œ

## 07 **Paging**

![image](https://user-images.githubusercontent.com/68107000/121764507-6fafa800-cb7f-11eb-91c7-fe1b133e51c3.png)

Paging

- Processì˜ virtual memory (logical memory)ë¥¼ ë™ì¼í•œ ì‚¬ì´ì¦ˆì˜ page ë‹¨ìœ„ë¡œ ë‚˜ëˆ”
- Virtual Memoryì˜ ë‚´ìš©ì´ Page ë‹¨ìœ„ë¡œ ***noncontiguous***í•˜ê²Œ ì €ì¥ë¨
- ì¼ë¶€ëŠ” backing storageì—, ì¼ë¶€ëŠ” physical memoryì— ì €ì¥

Basic Method

- physical memoryë¥¼ ë™ì¼í•œ í¬ê¸°ì˜ frameìœ¼ë¡œ ë‚˜ëˆ”
-  logical memoryë¥¼ ë™ì¼ í¬ê¸°ì˜ pageë¡œ ë‚˜ëˆ”
- ëª¨ë“  ê°€ìš© í”„ë ˆì„ë“¤ì„ ê´€ë¦¬
- page tableì„ ì‚¬ìš©í•˜ì—¬ logical addressë¥¼ physical addressë¡œ ë³€í™˜
- external fragmentation ë°œìƒ ì•ˆí•¨ (pageì™€ frame ì‚¬ì´ì¦ˆê°€ ê°™ê¸°ì— ì–´ë””ë“  ë„£ì„ ìˆ˜ ìˆìŒ)
- internal fragmentation ë°œìƒ ê°€ëŠ¥ (ë§ˆì§€ë§‰ìœ¼ë¡œ ì˜ë¦° í˜ì´ì§€ëŠ” ëª¨ë“  ê³µê°„ì„ ì‚¬ìš©í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ)

### Address Translation

![image](https://user-images.githubusercontent.com/68107000/121764733-0892f300-cb81-11eb-947b-0a589619a317.png)



page numberë¥¼ frame numberë¡œ ë³€í™˜í•˜ì—¬ physical address ê³„ì‚°ì„ í•˜ì—¬ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

- CPU <page number (p), page offset (d)> ì´ ë‘ ê°€ì§€ë¡œ êµ¬ì„±ëœ virtual addressë¥¼ ì‚¬ìš©í•œë‹¤.
  - page number (p)
    - page tableì˜ indexë¡œ ì‚¬ìš©
    - í•´ë‹¹ indexì—ëŠ” ê·¸ í˜ì´ì§€ì˜ ë¬¼ë¦¬ì  ë©”ëª¨ë¦¬ ìƒì˜ base addressê°€ ì €ì¥ë¨
  - page offset (d)
    - base address ì™€ ë”í•´ì ¸ì„œ physical address ê°€ êµ¬í•´ì§

#### **Implementation of Page Table**

- page tableì€ main memoryì— ìƒì£¼
- Page-Table Base Register (**PTBR**)ê°€ Page Tableì„ ê°€ë¦¬í‚´
- Page-Table Length Register (**PTLR**)ê°€ í…Œì´ë¸” í¬ê¸°ë¥¼ ë³´ê´€
- ëª¨ë“  ë©”ëª¨ë¦¬ ì ‘ê·¼ ì—°ì‚°ì—ëŠ” 2ë²ˆì˜ memory access í•„ìš”
  - Page Table ì ‘ê·¼ 1ë²ˆ + ì‹¤ì œ data/Instruction ì ‘ê·¼ 1ë²ˆ
- ì†ë„ í–¥ìƒì„ ìœ„í•´ associative register í˜¹ì€ translation lock-aside buffer (**TLB**)ë¼ ë¶ˆë¦¬ëŠ” ê³ ì†ì˜ lookup **hardware cache** ì‚¬ìš©
  - ![image](https://user-images.githubusercontent.com/68107000/121764910-578d5800-cb82-11eb-8b78-cfac2a9717fd.png)

#### **Associative Register**

Associative registers (TLB) : parallel searchê°€ ê°€ëŠ¥

- TLBì—ëŠ” page Table ì¤‘ ì¼ë¶€ë§Œ ì¡´ì¬

Address Translation

- page table ì¤‘ ì¼ë¶€ê°€ associative registerì— ë³´ê´€ë˜ì–´ ìˆìŒ
- ë§Œì•½ í•´ë‹¹ page numê°€ associative registerì— ìˆëŠ” ê²½ìš° ê³§ë°”ë¡œ frame numì„ ì–»ìŒ
- ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš° main memoryì— ìˆëŠ” page tableë¡œ ë¶€í„° frame numì„ ì–»ìŒ
- TLBëŠ” context switch ë•Œ flush (remove old entries)

#### **Effective Access Time**

Associative register lookup time = e

memory cycle time = 1

Hit ratio = a (associative registerì—ì„œ ì°¾ì•„ì§€ëŠ” ë¹„ìœ¨)

Effective Access Time = (1 + e)a + (2 + e)(1 - a)

---> 2 + e - a

------

### **2 Level page table**

page tableì„ ìœ„í•œ ê³µê°„ì„ ì¤„ì´ê¸° ìœ„í•´ ì‚¬ìš©

í˜„ëŒ€ì˜ ì»´í“¨í„°ëŠ” address spaceê°€ ë§¤ìš° í° í”„ë¡œê·¸ë¨ì„ ì§€ì›

- 32 bit addesss ì‚¬ìš©ì‹œ ==> 4GBì˜ ì£¼ì†Œ ê³µê°„
  - Page Sizeê°€ 4Kì‹œ 1Mê°œì˜ page table entryê°€ í•„ìš”
  - ê° page entryê°€ 4Bì‹œ í”„ë¡œì„¸ìŠ¤ë‹¹ 4Mì˜ page table í•„ìš”
  - ê·¸ëŸ¬ë‚˜ ëŒ€ë¶€ë¶„ì˜ í”„ë¡œê·¸ë¨ì€ 4Gì˜ ì£¼ì†Œ ê³µê°„ ì¤‘ ì§€ê·¹íˆ ì¼ë¶€ë¶„ë§Œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë‚­ë¹„ê°€ ì‹¬í•¨
- í˜ì´ì§€ í…Œì´ë¸” ìì²´ë¥¼ í˜ì´ì§€ë¡œ êµ¬ì„±
- ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì£¼ì†Œ ê³µê°„ì— ëŒ€í•œ outer page tableì˜ ì—”íŠ¸ë¦¬ ê°’ì€ NULL (ëŒ€ì‘í•˜ëŠ” inner page tableì´ ì—†ìŒ)

------

### **Multilevel Paging and Performance**

Address Spaceê°€ ë” ì»¤ì§€ë©´ ë‹¤ë‹¨ê³„ í˜ì´ì§€ í…Œì´ë¸” í•„ìš”

ê° ë‹¨ê³„ì˜ í˜ì´ì§€ í…Œì´ë¸”ì´ ë©”ëª¨ë¦¬ì— ì¡´ì¬í•˜ë¯€ë¡œ Logical addressì˜ physical address ë³€í™˜ì— ë” ë§ì€ ë©”ëª¨ë¦¬ ì ‘ê·¼ í•„ìš”

TLBë¥¼ í†µí•´ ë©”ëª¨ë¦¬ ì ‘ê·¼ ì‹œê°„ì„ ì¤„ì¼ ìˆ˜ ìˆìŒ

4ë‹¨ê³„ í˜ì´ì§€ í…Œì´ë¸”ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°

- ë©”ëª¨ë¦¬ ì ‘ê·¼ ì‹œê°„ì´ 100ns, TLB ì ‘ê·¼ ì‹œê°„ì´ 20ns, hit ratioê°€ 98%ì¸ ê²½ìš°
  - effective memory access time = 0.98 _ 120 + 0.02 _ 520 --> 128ns
  - ê²°ê³¼ì ìœ¼ë¡œ ì£¼ì†Œë³€í™˜ì„ ìœ„í•´ 28nsë§Œ ì†Œìš”

#### **Memory Protection**

Page Tableì˜ ê° entryë§ˆë‹¤ ì•„ë˜ì˜ bitë¥¼ ë‘”ë‹¤.

- Protection bit
  - Pageì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œ (read/write/read-only)
- Valid-invalid bit
  - validëŠ” í•´ë‹¹ ì£¼ì†Œì˜ frameì— ê·¸ í”„ë¡œì„¸ìŠ¤ë¥¼ êµ¬ì„±í•˜ëŠ” ìœ íš¨í•œ ë‚´ìš©ì´ ìˆìŒì„ ëœ»í•¨ (ì ‘ê·¼ í—ˆìš©)
  - invalidëŠ” í•´ë‹¹ ì£¼ì†Œì˜ frameì— ìœ íš¨í•œ ë‚´ìš©ì´ ì—†ìŒì„ ëœ»í•¨ (ì ‘ê·¼ ë¶ˆí—ˆ)

#### **Inverted Page Table**

![image](https://user-images.githubusercontent.com/68107000/121764967-b9e65880-cb82-11eb-873c-12e4f64e54d8.png)

Page Tableì´ ë§¤ìš° í° ì´ìœ 

- ëª¨ë“  process ë³„ë¡œ ê·¸ logical addressì— ëŒ€ì‘í•˜ëŠ” ëª¨ë“  pageì— ëŒ€í•´ page table entryê°€ ì¡´ëŒ€
- ëŒ€ì‘í•˜ëŠ” pageê°€ ë©”ëª¨ë¦¬ì— ìˆë“  ì•„ë‹ˆë“  ê°„ì— page tableì—ëŠ” entryë¡œ ì¡´ì¬

Inverted Page table

- Page frame í•˜ë‚˜ë‹¹ page tableì— í•˜ë‚˜ì˜ entryë¥¼ ë‘” ê²ƒ ( system - wide )
- ê° page table entryëŠ” ê°ê°ì˜ ë¬¼ë¦¬ì  ë©”ëª¨ë¦¬ì˜ page frameì´ ë‹´ê³  ìˆëŠ” ë‚´ìš© í‘œì‹œ (process-id, processì˜ logiscal address)
- ë‹¨ì  : í…Œì´ë¸” ì „ì²´ë¥¼ íƒìƒ‰í•´ì•¼í•¨
- ì¡°ì¹˜ : associative register ì‚¬ìš© (expensive)

#### **Shared Page**

Shared code

- Re-entrant Code (=Pure code) : ì•„ë˜ì˜ ë‘ ì¡°ê±´ì„ ë§Œì¡±í•´ì•¼í•¨
  - read onlyë¡œ í•˜ì—¬ í”„ë¡œì„¸ìŠ¤ ê°„ì— í•˜ë‚˜ì˜ codeë§Œ ë©”ëª¨ë¦¬ì— ì˜¬ë¦¼
  - Shared codeëŠ” ëª¨ë“  í”„ë¡œì„¸ìŠ¤ì˜ logical address spaceì—ì„œ ë™ì¼í•œ ìœ„ì¹˜ì— ìˆì–´ì•¼ í•¨

Private Code and Data

- ê° í”„ë¡œì„¸ìŠ¤ë“¤ì€ ë…ìì ìœ¼ë¡œ ë©”ëª¨ë¦¬ì— ì˜¬ë¦¼
- Private dataëŠ” logical address spaceì˜ ì•„ë¬´ê³³ì— ì™€ë„ ë¬´ë°©

## ?. **Segmentation**

### -1. Segment

í”„ë¡œê·¸ë¨ì€ <u>ì˜ë¯¸ ë‹¨ìœ„</u>ì¸ **ì—¬ëŸ¬ ê°œì˜ segment**ë¡œ êµ¬ì„± (â†” pageëŠ” ë™ì¼í•œ í¬ê¸° ë‹¨ìœ„)

- ì‘ê²ŒëŠ” í”„ë¡œê·¸ë¨ì„ êµ¬ì„±í•˜ëŠ” í•¨ìˆ˜ í•˜ë‚˜í•˜ë‚˜ë¥¼ ì„¸ê·¸ë¨¼íŠ¸ë¡œ ì •ì˜
- í¬ê²ŒëŠ” í”„ë¡œê·¸ë¨ ì „ì²´ë¥¼ í•˜ë‚˜ì˜ ì„¸ê·¸ë¨¼íŠ¸ë¡œ ì •ì˜ ê°€ëŠ¥
- **ì¼ë°˜ì ìœ¼ë¡œëŠ” code, data, stack** ë¶€ë¶„ì´ í•˜ë‚˜ì”©ì˜ ì„¸ê·¸ë¨¼íŠ¸ë¡œ ì •ì˜ë¨
  - í”„ë¡œì„¸ìŠ¤ëŠ” ë©”ëª¨ë¦¬ ê³µê°„ì´ code, data, stackìœ¼ë¡œ ë‚˜ëˆ„ì–´ì ¸ ìˆìŒ.

segmentëŠ” ë‹¤ìŒê³¼ ê°™ì€ **logical unit** ë“¤ì„. ë‹¤ì–‘í•œ í¬ê¸°ì™€ ë¬¶ëŠ” ë°©ë²•ì´ ìˆì„ ìˆ˜ ìˆìŒ.

- main(), function, global variables, stack, symbol table, arrays

### -2. Segmentation Architecture

![image](https://user-images.githubusercontent.com/68107000/121536551-20159300-ca3e-11eb-99dd-5bd5976035c6.png)

- ğŸ’› ë…¼ë¦¬ì  ì£¼ì†ŒëŠ” **segment-number (2ë²ˆ segment), offset (100ë²ˆì§€)**ìœ¼ë¡œ êµ¬ì„±ë¨

- ğŸ’› **Segment table**
  - each table entry has:
    - **limit**: length of the segment (2ë²ˆ segmentì˜ size)
    - **base**: starting physical address of the segment (2ë²ˆ segmentì˜ physical ì‹œì‘ ë²ˆì§€)

- ğŸ’› **segment table base register (STBR)**
  - ë¬¼ë¦¬ì  ë©”ëª¨ë¦¬ì—ì„œì˜ segment tableì˜ ìœ„ì¹˜

- ğŸ’› **segment table length register (STLR)**
  - í”„ë¡œê·¸ë¨ì´ ì‚¬ìš©í•˜ëŠ” segmentì˜ ìˆ˜

  - segment number s is legal if s < STLR. 

    ì™œ ë™ë“±ì´ ì•„ë‹ˆëƒ?  segment ê°œìˆ˜ê°€ 5ê°œ (STLR = 5)ì¼ ë•Œ, sëŠ” 0~4 ê°’ì´ ê°€ëŠ¥

-----

\*** **segmentì˜ ê¸¸ì´ê°€ ë™ì¼í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ê°€ë³€ë¶„í•  ë°©ì‹ì—ì„œì™€ ë™ì¼í•œ ë¬¸ì œì ë“¤ì´ ë°œìƒí•œë‹¤.**

- ğŸ’› **Allocation**
  - first-fit / best fit
  - ë‹¨ì : **external fragementation ë°œìƒ**

-----

\*** **segmentëŠ” ì˜ë¯¸ ë‹¨ìœ„ì´ê¸° ë•Œë¬¸ì— ê³µìœ ì™€ ë³´ì•ˆì— ìˆì–´ pagingë³´ë‹¤ í›¨ì”¬ íš¨ê³¼ì ì´ë‹¤.**

- ğŸ’› **Protection**
  - ê° ì„¸ê·¸ë¨¼íŠ¸ ë³„ë¡œ protection bitê°€ ìˆìŒ - 
  - Each entry:
    - Valid bit = 0 â†’ illegal segment
    - Read/Write/Execution ê¶Œí•œ bit

- ğŸ’› **Sharing**
  - shared segment
  - same segment number

## -3. **Segmentation with Paging**

í° í‹€ì€ segmentë¡œ ë‚˜ëˆ´ëŠ”ë°, segment ì•ˆì„ pageë¡œ ë‚˜ëˆˆ ë°©ì‹ì´ë‹¤.

**pure segmentation ê³¼ì˜ ì°¨ì´ì **

- *segment-table entry*ê°€ 

  segmentì˜ *base address*ë¥¼ ê°€ì§€ê³  ìˆëŠ” ê²ƒì´ ì•„ë‹ˆë¼ 

  **segmentë¥¼ êµ¬ì„±í•˜ëŠ” *page table*ì˜ *base address*ë¥¼ ê°€ì§€ê³  ìˆìŒ**

**ì¥ì **

- segmentê°€ 4K ë°°ìˆ˜ë§Œí¼ ì›€ì§ì´ê¸° ë•Œë¬¸ì— fragmentationì´ ì¤„ì–´ë“¦.

**ë‹¨ì **

- ë³µì¡í•œ êµ¬ì¡°(logic) â†’ bug ê°€ëŠ¥ì„±ì´ ì¦ê°€í•˜ê³  ë©”ëª¨ë¦¬ í¬ê¸°ì— ì˜í–¥
- fragmentationì´ ë°œìƒí•˜ê¸´ í•¨

![image](https://user-images.githubusercontent.com/68107000/121541770-8b616400-ca42-11eb-8c1c-819a92e5af23.png)

segment numberê³¼ offset(d)ë¥¼ cpuê°€ ìš”ì²­í•˜ë©´

STBRì˜ ê°’ì„ ì´ìš©í•˜ì—¬ segment tableì— ì ‘ê·¼í•´ì„œ ìš”ì²­í•œ segment numberì˜ ì œí•œ(ê¸¸ì´)ê³¼ page-tableì˜ base ê°’ì„ ì•Œì•„ë‚¸ë‹¤.

(segment tableì— STBR + segment numberë¡œ ì ‘ê·¼í–ˆë“¯ì´ page-tableì˜ base ê°’ì„ ì•Œì•„ë‚¸ ê²ƒì´ë‹¤. ê·¸ë¦¬ê³  ê° segmentëŠ” ë‹¤ë¥¸ page tableì„ ì°¸ì¡°í•œë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.)

offsetì€ í•´ë‹¹ segmentì˜ limitê³¼ ë¹„êµí•œ í›„ legalí•˜ë‹¤ë©´ (segmentì˜) **offset**ë¥¼ ë‹¤ì‹œ **page numberì™€ sub-offset ë²ˆí˜¸ë¡œ ë‚˜ëˆˆë‹¤.**

page tableì˜ base ê°’ì— page numberì„ ë”í•´ ì°¾ê²Œ ëœ frameê³¼ sub-offset ìœ¼ë¡œ ì›í•˜ëŠ” ë©”ëª¨ë¦¬ì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ëœë‹¤.



ì •ë¦¬í•˜ìë©´, segment numberë¡œ segment tableì„ í†µí•´ ì›í•˜ëŠ” í˜ì´ì§€ í…Œì´ë¸”ì„ ì°¾ëŠ”ë‹¤.

offsetìœ¼ë¡œ ëª‡ ë²ˆì§¸ page(frame), ì–´ë””ì— ì¡´ì¬í•˜ëŠ”ì§€ ì•Œì•„ë‚¸ë‹¤.

